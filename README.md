# ESP32 ADS-B Companion (4" TFT Plane Radar)

This project runs on an ESP32 with a 480x320 TFT and shows nearby aircraft on a static map background.  
It fetches live ADS-B JSON data over Wi-Fi (e.g. from a local ADS-B receiver / tar1090 / dump1090 JSON endpoint), tracks aircraft, and renders plane icons oriented by heading. Plane color is based on altitude bands. A bottom bar shows summary stats and nearest aircraft.

## Video

Demo / overview video:  
https://youtu.be/luJIPpM341g

---

## Features

- 480x320 map background (stored as `background565.h` in PROGMEM)
- Fetch aircraft JSON every `FETCH_PERIOD_MS` (default 1000 ms)
- Track up to `MAX_TRACKS` aircraft with TTL expiry
- Draw up to `MAX_DRAW` aircraft per refresh (performance knob)
- Altitude color bands + legend bar at the top
- Bottom status bar with differential text update (reduced flicker)
- Splash screen with fade in/out + backlight control
- Three PlatformIO build targets:
  - CYD 4" integrated board (ST7796)
  - External 4" TFT (ILI9488) + standard ESP32 DevKit (DC=GPIO5)
  - External 4" TFT (ILI9488) + ESP32U antenna variant (DC=GPIO0)

---

## Hardware

### Supported displays / targets

1. **CYD 4" integrated board (ST7796)**  
   PlatformIO env: `cyd4_st7796`

2. **External 4" TFT (ILI9488) + standard ESP32 DevKit** (TFT_DC = GPIO5)  
   PlatformIO env: `ext_ili9488_dc5`

3. **External 4" TFT (ILI9488) + ESP32U / antenna variant** (TFT_DC = GPIO0)  
   PlatformIO env: `ext_ili9488_dc0_antenna`

---

## Software / Libraries

- PlatformIO (Arduino framework)
- `TFT_eSPI`
- `ArduinoJson`
- `HTTPClient`
- Custom libraries (in your `/lib` folder):
  - `HB9IIU_RobustWIfiConnection.h`
  - `HB9IIU_BacklightControl.h`
- Static images / assets:
  - `background565.h` (generated by Python tools)
  - `splash565.h`
  - `plane32_360.h`

---

## Configuration (Config.h)

You must provide a `Config.h` (or edit yours) with at least:

- Your home location:
  - `HOME_LAT`, `HOME_LON`
- ADS-B JSON endpoint:
  - `AIRCRAFT_URL`
- Map projection parameters:
  - `MAP_ZOOM`, `MAP_PX0`, `MAP_PY0`

---

## IMPORTANT: Generate your own map background (background565.h)

This project **does not** auto-create the map background.  
You must generate `background565.h` for **your own location** using the included Python tools.

### Where the Python tools are

In the repo:

- `pythonTools/GoogleMaps.py`
- `pythonTools/OpenStreetMaps.py`

### Choose ONE

Use **one or the other**:

- **GoogleMaps.py** (Google tiles / Google-based workflow)
- **OpenStreetMaps.py** (OpenStreetMap tiles)

Both scripts are meant to produce the same output: a **480Ã—320 RGB565 header file** used by the ESP32 code:

- `src/background565.h`

### How to use

Open the script you want to use (**GoogleMaps.py** or **OpenStreetMaps.py**) and follow the instructions **inside the code**.  
Inside the script you will set things like:

- your **latitude / longitude**
- the **zoom level**
- and the **output file name**

The script will generate the RGB565 background and save it as a C header file (typically `background565.h`).

### After generating the background

Make sure your `Config.h` values match the background you generated:

- `MAP_ZOOM`
- `MAP_PX0`
- `MAP_PY0`

If these do not match your generated map, aircraft icons will not line up with the map correctly.

---

## Build & Upload (PlatformIO)

In `platformio.ini` choose a build target:

```ini
[platformio]
default_envs = ext_ili9488_dc0_antenna
